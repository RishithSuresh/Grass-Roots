# GrassRoots Platform - Backend API Documentation

## Base URL
```
http://localhost:3000/api
```

## Authentication
All protected endpoints require JWT token in header:
```
Authorization: Bearer <token>
```

---

## 1. Authentication Endpoints

### POST /auth/register
Register a new user (farmer or retailer)

**Request Body:**
```json
{
  "email": "farmer@example.com",
  "password": "password123",
  "full_name": "John Doe",
  "phone": "9876543210",
  "user_type": "farmer",
  "farm_location": "Bangalore",
  "farm_size_acres": 5.5
}
```

**Response:**
```json
{
  "success": true,
  "message": "User registered successfully",
  "user_id": 1,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### POST /auth/login
Login user

**Request Body:**
```json
{
  "email": "farmer@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "user_id": 1,
    "email": "farmer@example.com",
    "full_name": "John Doe",
    "user_type": "farmer"
  }
}
```

---

## 2. Farmer Endpoints

### GET /farmer/crops
Get all crops for logged-in farmer

**Response:**
```json
{
  "success": true,
  "crops": [
    {
      "crop_id": 1,
      "crop_name": "Rice",
      "planting_date": "2025-01-15",
      "area_acres": 2.5,
      "expected_yield_quintals": 50,
      "status": "growing",
      "notes": "Good soil quality"
    }
  ]
}
```

### POST /farmer/crops
Add new crop information

**Request Body:**
```json
{
  "crop_type_id": 1,
  "planting_date": "2025-01-15",
  "area_acres": 2.5,
  "expected_yield_quintals": 50,
  "notes": "Good soil quality"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Crop added successfully",
  "crop_id": 1
}
```

### GET /farmer/market-prices
Get current market prices for all crops

**Response:**
```json
{
  "success": true,
  "prices": [
    {
      "crop_name": "Rice",
      "market_location": "Bangalore",
      "price_per_quintal": 2500.00,
      "price_date": "2025-01-17"
    }
  ]
}
```

### POST /farmer/qr-generate
Generate QR code for a crop batch

**Request Body:**
```json
{
  "crop_id": 1,
  "batch_number": "BATCH001",
  "quantity_kg": 500,
  "harvest_date": "2025-04-15"
}
```

**Response:**
```json
{
  "success": true,
  "qr_id": 1,
  "qr_code_data": "QR_DATA_STRING",
  "qr_code_image_url": "/uploads/qr/qr_1.png"
}
```

### GET /farmer/qr-codes
Get all QR codes generated by farmer

**Response:**
```json
{
  "success": true,
  "qr_codes": [
    {
      "qr_id": 1,
      "crop_name": "Rice",
      "batch_number": "BATCH001",
      "quantity_kg": 500,
      "harvest_date": "2025-04-15",
      "is_active": true
    }
  ]
}
```

---

## 3. Retailer Endpoints

### GET /retailer/products
Get all products in retailer's catalog

**Response:**
```json
{
  "success": true,
  "products": [
    {
      "product_id": 1,
      "product_name": "Organic Rice",
      "price_per_kg": 50.00,
      "available_quantity_kg": 500,
      "batch_number": "BATCH001",
      "farmer_name": "John Doe"
    }
  ]
}
```

### POST /retailer/products
Add product to catalog (must have valid QR code)

**Request Body:**
```json
{
  "qr_id": 1,
  "product_name": "Organic Rice",
  "description": "Premium quality rice",
  "price_per_kg": 50.00,
  "available_quantity_kg": 500,
  "category": "Grains"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Product added successfully",
  "product_id": 1
}
```

### GET /retailer/orders
Get all orders for retailer

**Response:**
```json
{
  "success": true,
  "orders": [
    {
      "order_id": 1,
      "product_name": "Organic Rice",
      "quantity_kg": 100,
      "total_amount": 5000.00,
      "order_status": "pending",
      "payment_status": "unpaid",
      "order_date": "2025-01-17T10:30:00Z"
    }
  ]
}
```

### POST /retailer/orders
Create new order

**Request Body:**
```json
{
  "product_id": 1,
  "quantity_kg": 100,
  "delivery_date": "2025-01-20",
  "notes": "Urgent delivery required"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Order created successfully",
  "order_id": 1,
  "total_amount": 5000.00
}
```

### GET /retailer/payments
Get all payments for retailer

**Response:**
```json
{
  "success": true,
  "payments": [
    {
      "payment_id": 1,
      "order_id": 1,
      "amount": 5000.00,
      "payment_status": "pending",
      "payment_date": "2025-01-17T10:30:00Z"
    }
  ]
}
```

### POST /retailer/payments
Process payment for an order

**Request Body:**
```json
{
  "order_id": 1,
  "payment_method": "upi",
  "transaction_id": "TXN123456789"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Payment processed successfully",
  "payment_id": 1
}
```

### GET /retailer/qr-codes
Get all available QR codes (from farmers) for adding products

**Response:**
```json
{
  "success": true,
  "qr_codes": [
    {
      "qr_id": 1,
      "crop_name": "Rice",
      "batch_number": "BATCH001",
      "quantity_kg": 500,
      "harvest_date": "2025-04-15",
      "farmer_name": "John Doe",
      "is_active": true
    }
  ]
}
```

---

## 4. Common Endpoints

### GET /crop-types
Get all available crop types

**Response:**
```json
{
  "success": true,
  "crop_types": [
    {
      "crop_type_id": 1,
      "crop_name": "Rice",
      "category": "Cereal",
      "description": "Staple grain crop"
    }
  ]
}
```

### GET /notifications
Get notifications for logged-in user

**Response:**
```json
{
  "success": true,
  "notifications": [
    {
      "notification_id": 1,
      "title": "New Order",
      "message": "You have a new order for Organic Rice",
      "notification_type": "order",
      "is_read": false,
      "created_at": "2025-01-17T10:30:00Z"
    }
  ]
}
```

### PUT /notifications/:id/read
Mark notification as read

**Response:**
```json
{
  "success": true,
  "message": "Notification marked as read"
}
```

---

## Error Responses

All endpoints return errors in this format:

```json
{
  "success": false,
  "error": "Error message here"
}
```

**Common HTTP Status Codes:**
- 200: Success
- 201: Created
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 500: Internal Server Error

---

## Implementation Notes

1. **Technology Stack:**
   - Node.js + Express.js
   - MySQL database
   - JWT for authentication
   - bcrypt for password hashing
   - QR code generation library

2. **Security:**
   - All passwords hashed with bcrypt
   - JWT tokens expire after 24 hours
   - Input validation on all endpoints
   - SQL injection prevention using parameterized queries

3. **File Structure:**
```
backend/
├── server.js
├── config/
│   └── database.js
├── middleware/
│   └── auth.js
├── routes/
│   ├── auth.js
│   ├── farmer.js
│   └── retailer.js
├── controllers/
│   ├── authController.js
│   ├── farmerController.js
│   └── retailerController.js
└── models/
    ├── User.js
    ├── Crop.js
    ├── QRCode.js
    ├── Product.js
    ├── Order.js
    └── Payment.js
```

