<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Crop Information - GrassRoots</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/auth.js" defer></script>
  <script src="js/utils.js" defer></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-container container">
      <a href="index.html" class="logo">GrassRoots</a>
      <div class="nav-links">
        <a href="farmer-dashboard.html">Dashboard</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </nav>

  <main class="container" style="padding:2.5rem 0;">
    <div class="form-container" style="max-width:980px;margin:96px auto 40px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem;">
        <h2 style="color:var(--primary-color);font-size:1.15rem;margin:0;display:flex;align-items:center;gap:0.6rem;">üçÉ Manage Your Crop Information</h2>
        <div style="color:var(--muted);font-size:0.95rem;opacity:0.9">&nbsp;</div>
      </div>

      <!-- Crop Information Form -->
      <form id="cropInfoFormLocal">
        <div class="form-group">
          <label for="cropTypeLocal">Crop Type</label>
          <select id="cropTypeLocal" required>
            <option value="">Select Crop</option>
            <option value="Rice">Rice</option>
            <option value="Wheat">Wheat</option>
            <option value="Maize">Maize</option>
            <option value="Vegetables">Vegetables</option>
            <option value="Cotton">Cotton</option>
            <option value="Sugarcane">Sugarcane</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="plantingDateLocal">Planting Date</label>
          <input type="date" id="plantingDateLocal" required>
        </div>
        <div class="form-group">
          <label for="areaLocal">Area (in acres)</label>
          <input type="number" id="areaLocal" step="0.1" required>
        </div>
        <div class="form-group">
          <label for="expectedYieldLocal">Expected Yield (in quintals)</label>
          <input type="number" id="expectedYieldLocal" step="0.1" required>
        </div>
        <div class="form-group">
          <label for="cropNotesLocal">Additional Notes</label>
          <textarea id="cropNotesLocal" rows="3" placeholder="Any special details about your crop..."></textarea>
        </div>
        <button type="submit" class="btn save-btn">Save Crop Information</button>
      </form>

      <div style="margin-top:1.5rem;">
        <h3 style="font-size:1rem;margin-bottom:0.6rem;color:var(--text-color);">Your Saved Crops:</h3>
        <div id="cropListLocal" class="saved-crops-grid"></div>
      </div>
    </div>
  </main>

  <script>
    // Auth guard - use centralized system
    if (!GrassRootsAuth.requireAuth('farmer')) {
      // Will redirect automatically if not authorized
    }

    // Render saved crops list
    function renderCropList() {
      const crops = GrassRootsUtils.loadFromStorage('farmerCrops', []);
      const out = document.getElementById('cropListLocal');

      if (!crops.length) {
        out.innerHTML = '<p style="color:var(--muted);">No crops added yet.</p>';
        return;
      }

      let html = '';
      crops.forEach(c => {
        const dateStr = c.plantingDate ? GrassRootsUtils.formatDate(c.plantingDate) : 'Not specified';
        html += `
          <div class="crop-card">
            <div class="crop-card-inner">
              <div class="crop-title">${GrassRootsUtils.sanitizeHTML(c.type || 'Unknown')}</div>
              <div class="crop-meta">Area: ${c.area || '‚Äî'} acres | Yield: ${c.expectedYield || '‚Äî'} qt</div>
              <div class="crop-date">Planted: ${dateStr}</div>
              ${c.notes ? `<div class="crop-notes">${GrassRootsUtils.sanitizeHTML(c.notes)}</div>` : ''}
            </div>
          </div>
        `;
      });
      out.innerHTML = html;
    }

    // Handle form submission
    document.getElementById('cropInfoFormLocal').addEventListener('submit', function(e) {
      e.preventDefault();

      // Get form values
      const crop = {
        id: GrassRootsUtils.generateId(),
        type: document.getElementById('cropTypeLocal').value,
        plantingDate: document.getElementById('plantingDateLocal').value,
        area: document.getElementById('areaLocal').value,
        expectedYield: document.getElementById('expectedYieldLocal').value,
        notes: document.getElementById('cropNotesLocal').value,
        createdAt: new Date().toISOString()
      };

      // Save to localStorage
      let crops = GrassRootsUtils.loadFromStorage('farmerCrops', []);
      crops.push(crop);
      GrassRootsUtils.saveToStorage('farmerCrops', crops);

      // Show success feedback
      const btn = document.querySelector('.save-btn');
      const originalText = btn.textContent;
      btn.textContent = 'Saved ‚úì';
      btn.style.backgroundColor = '#4caf50';

      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = '';
      }, 1500);

      // Reset form and update list
      this.reset();
      renderCropList();

      // Show toast notification
      GrassRootsUtils.showToast('Crop information saved successfully!', 'success');
    });

    // Initial render
    renderCropList();
  </script>
</body>
</html>